<header class="navbar">
  <div class="brand">
    <span class="brand-icon">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 640 640"
        aria-hidden="true"
      >
        <path
          d="M296 88C296 74.7 306.7 64 320 64C333.3 64 344 74.7 344 88L344 128L400 128C417.7 128 432 142.3 432 160C432 177.7 417.7 192 400 192L285.1 192C260.2 192 240 212.2 240 237.1C240 259.6 256.5 278.6 278.7 281.8L370.3 294.9C424.1 302.6 464 348.6 464 402.9C464 463.2 415.1 512 354.9 512L344 512L344 552C344 565.3 333.3 576 320 576C306.7 576 296 565.3 296 552L296 512L224 512C206.3 512 192 497.7 192 480C192 462.3 206.3 448 224 448L354.9 448C379.8 448 400 427.8 400 402.9C400 380.4 383.5 361.4 361.3 358.2L269.7 345.1C215.9 337.5 176 291.4 176 237.1C176 176.9 224.9 128 285.1 128L296 128L296 88z"
        />
      </svg>
    </span>

    <span class="brand-text">APP Deudas</span>
  </div>

  <div class="user-actions">
    <span class="user-name">{{ userName }}</span>
    <button class="logout-btn" (click)="logout()">Cerrar sesión</button>
  </div>
</header>

<main class="container">

  <section class="summary" *ngIf="summary$ | async as summary">
    <div class="summary-cards">
      <div class="card paid">
        <h4>Total pagado</h4>
        <p>{{ summary.totalPagado | currency:'COP':'symbol-narrow':'1.0-0' }}</p>
        <span>{{ summary.cantidadPagadas }} deudas</span>
      </div>

      <div class="card pending">
        <h4>Total pendiente</h4>
        <p>{{ summary.totalPendiente | currency:'COP':'symbol-narrow':'1.0-0' }}</p>
        <span>{{ summary.cantidadPendientes }} deudas</span>
      </div>
    </div>
  </section>

  <ng-container *ngIf="debts$ | async"></ng-container>

  <section class="actions">
    <div class="filters">
      <label class="filter-label">Filtrar por</label>

      <div class="select-wrapper">
        <select [formControl]="filterControl" class="filter-select">
          <option value="all">Todas</option>
          <option value="pending">Pendientes</option>
          <option value="paid">Pagadas</option>
        </select>
        <span class="select-arrow"></span>
      </div>
    </div>

    <button class="new-btn" (click)="newDebt()">+ Nueva deuda</button>
    <button class="export-btn" (click)="exportDebts()">
      Exportar
    </button>
  </section>

  <section class="table-wrapper">
    <div *ngIf="loading$ | async" class="loading">
      Cargando deudas...
    </div>

    <ng-container *ngIf="!(loading$ | async)">
      <ng-container *ngIf="filteredDebts$ | async as filteredDebts">
        <div *ngIf="filteredDebts.length === 0" class="empty">
          No hay deudas para mostrar
        </div>

        <table *ngIf="filteredDebts.length > 0">
          <thead>
            <tr>
              <th>Título</th>
              <th>Monto</th>
              <th>Estado</th>
              <th>Fecha</th>
              <th class="actions-col">Acciones</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let debt of filteredDebts; trackBy: trackByDebtId" (click)="openDetail(debt.id)">
              <td>{{ debt.title }}</td>
              <td>{{ debt.amount | currency:'COP':'symbol-narrow':'1.0-0' }}</td>

              <td>
                <span class="status" [class.pending]="debt.status === 'PENDING'" [class.paid]="debt.status === 'PAID'">
                  {{ debt.status === 'PENDING' ? 'Pendiente' : 'Pagada' }}
                </span>
              </td>

              <td>{{ debt.createdAt | date:'dd/MM/yyyy' }}</td>

              <td class="actions-cell" (click)="$event.stopPropagation()">

                <button
                  class="icon-btn view"
                  title="Ver detalle"
                  (click)="openDetail(debt.id); $event.stopPropagation()"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <path
                      d="M288 80C181 80 89.8 145.1 48 256c41.8 110.9 133 176 240 176s198.2-65.1 240-176C486.2 145.1 395 80 288 80zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112zm0-176c-35.3 0-64 28.7-64 64s28.7 64 64 64 64-28.7 64-64-28.7-64-64-64z"
                    />
                  </svg>
                </button>

                <button *ngIf="debt.status === 'PENDING'" class="icon-btn pay" title="Marcar como pagada"
                  (click)="payDebt(debt)">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path d="M320 48C306.7 48 296 58.7 296 72L296 84L294.2 84C257.6 84 228 113.7 228 150.2C228 183.6 252.9 211.8 286 215.9L347 223.5C352.1 224.1 356 228.5 356 233.7C356 239.4 351.4 243.9 345.8 243.9L272 244C256.5 244 244 256.5 244 272C244 287.5 256.5 300 272 300L296 300L296 312C296 325.3 306.7 336 320 336C333.3 336 344 325.3 344 312L344 300L345.8 300C382.4 300 412 270.3 412 233.8C412 200.4 387.1 172.2 354 168.1L293 160.5C287.9 159.9 284 155.5 284 150.3C284 144.6 288.6 140.1 294.2 140.1L360 140C375.5 140 388 127.5 388 112C388 96.5 375.5 84 360 84L344 84L344 72C344 58.7 333.3 48 320 48zM141.3 405.5L98.7 448L64 448C46.3 448 32 462.3 32 480L32 544C32 561.7 46.3 576 64 576L384.5 576C413.5 576 441.8 566.7 465.2 549.5L591.8 456.2C609.6 443.1 613.4 418.1 600.3 400.3C587.2 382.5 562.2 378.7 544.4 391.8L424.6 480L312 480C298.7 480 288 469.3 288 456C288 442.7 298.7 432 312 432L384 432C401.7 432 416 417.7 416 400C416 382.3 401.7 368 384 368L231.8 368C197.9 368 165.3 381.5 141.3 405.5z"/></svg>
                </button>

                <button class="icon-btn edit" title="Editar" (click)="editDebt(debt)">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path d="M535.6 85.7C513.7 63.8 478.3 63.8 456.4 85.7L432 110.1L529.9 208L554.3 183.6C576.2 161.7 576.2 126.3 554.3 104.4L535.6 85.7zM236.4 305.7C230.3 311.8 225.6 319.3 222.9 327.6L193.3 416.4C190.4 425 192.7 434.5 199.1 441C205.5 447.5 215 449.7 223.7 446.8L312.5 417.2C320.7 414.5 328.2 409.8 334.4 403.7L496 241.9L398.1 144L236.4 305.7zM160 128C107 128 64 171 64 224L64 480C64 533 107 576 160 576L416 576C469 576 512 533 512 480L512 384C512 366.3 497.7 352 480 352C462.3 352 448 366.3 448 384L448 480C448 497.7 433.7 512 416 512L160 512C142.3 512 128 497.7 128 480L128 224C128 206.3 142.3 192 160 192L256 192C273.7 192 288 177.7 288 160C288 142.3 273.7 128 256 128L160 128z"/></svg>
                </button>

                <button class="icon-btn delete" title="Eliminar" (click)="deleteDebt(debt)">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path d="M262.2 48C248.9 48 236.9 56.3 232.2 68.8L216 112L120 112C106.7 112 96 122.7 96 136C96 149.3 106.7 160 120 160L520 160C533.3 160 544 149.3 544 136C544 122.7 533.3 112 520 112L424 112L407.8 68.8C403.1 56.3 391.2 48 377.8 48L262.2 48zM128 208L128 512C128 547.3 156.7 576 192 576L448 576C483.3 576 512 547.3 512 512L512 208L464 208L464 512C464 520.8 456.8 528 448 528L192 528C183.2 528 176 520.8 176 512L176 208L128 208zM288 280C288 266.7 277.3 256 264 256C250.7 256 240 266.7 240 280L240 456C240 469.3 250.7 480 264 480C277.3 480 288 469.3 288 456L288 280zM400 280C400 266.7 389.3 256 376 256C362.7 256 352 266.7 352 280L352 456C352 469.3 362.7 480 376 480C389.3 480 400 469.3 400 456L400 280z"/></svg>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-container>
    </ng-container>
  </section>
</main>